# .ps_project/config.yaml:

version: 2

workflows:
  experiment-workflow:
    steps:
      name: "my-experiment"
      command: experiment.run_single_node
      params:
        command: python run.py
        container: pytorch/pytorch:1.5-cuda10.1-cudnn7-runtime
        experimentEnv:
          EPOCHS_EVAL: 5
          EVAL_SECS: 10
          MAX_STEPS: 1000
          TRAIN_EPOCHS: 10
        machineType: P4000
        modelPath: /artifacts
        modelType: pytorch
        name: template
      checks: #[optional]
        onnx:loss:
          target: "0.0..0.5"
          aggregate: "mean"
        defaults: #[optional]
          precision: 3
    triggers:
      branches:
        ignore: irrelevant-branch
      tags:
        only:
          - v.*
          - latest
  param-file-experiment-workflow:
    steps:
      name: "param-file-experiment"
      command: experiment.run_single_node
      paramsFile: .ps_project/param-file-experiment.yml
      checks: #[optional]
        custom:loss:
          target: "0.0..0.5"
          aggregate: "/mean/0"
    triggers:
      branches:
        only: master
